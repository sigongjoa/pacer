# PACER 아키텍처 V1: 비용 최적화 및 위험 완화 제안서

## 1. 배경

최초 설계된 명세서(`PACER_Class_Diagram`, `Database_Schema`, `API_Specification`)에 대한 비판적 검토 결과, 다음과 같은 3가지 핵심적인 비용 위험이 식별되었습니다.

1.  **가변 운영비(OPEX) 폭증 위험:** `LLMFilter` 호출 시 과도한 토큰 사용 및 `AIModule`과의 책임 모호성으로 인한 '이중 과금' 가능성.
2.  **숨겨진 MLOps 비용(CAPEX) 위험:** `learn_from_feedback` 기능에 내포된 '자동 파인튜닝 파이프라인' 구축의 막대한 초기 투자 비용.
3.  **성능 및 저장 비용(OPEX) 위험:** `LLM_LOGS` 테이블의 급격한 증가로 인한 데이터베이스 조회 성능 저하 및 유지보수 비용 증가.

본 문서는 이러한 위험을 V1 단계에서 원천적으로 완화하기 위한 새로운 아키텍처를 제안합니다.

## 2. V1 아키텍처 핵심 변경 원칙

> **"V1의 목표는 '자동으로 똑똑해지는 AI'가 아니라, '똑똑한 AI를 만들기 위한 데이터를 저비용으로 수집하는 시스템'이다."**

### 원칙 1: LLM 호출은 오직 1번, 그리고 가볍게

*   **`AIModule`의 역할 명확화:** `AIModule`의 `analyze_submission()`은 **LLM을 사용하지 않는 규칙 기반(Rule-Based) 엔진**으로 한정합니다. (e.g., 정답 비교, 키워드 분석 등)
*   **`LLMFilter`의 역할 집중:** LLM 호출은 오직 `LLMFilter`의 `judge_anki_necessity()`에서만 발생합니다. 이로써 '이중 과금' 위험을 원천 차단합니다.
*   **API 페이로드 최적화:** `LLMFilter` 호출 시, 방대한 JSON 객체 대신 LLM의 판단에 필요한 최소한의 정보(e.g., `student_level`, `error_context`, `question_intent`)만을 담은 **경량화된 JSON 또는 Prompt 문자열**을 전송하여 토큰 비용을 최소화합니다.

### 원칙 2: "자동 파인튜닝" 대신 "수동 프롬프트 엔지니어링"

*   **`learn_from_feedback` 기능의 역할 변경:** V1에서 이 기능은 더 이상 자동 학습을 의미하지 않습니다. 코치의 피드백(`GOOD`/`BAD`)을 `LLM_LOGS` 테이블에 **기록(Logging)하는 역할만**을 수행합니다.
*   **V1의 개선 사이클:** 개발자/기획자는 주기적으로 `LLM_LOGS`에 쌓인 '황금 데이터셋'을 **수동으로 분석**합니다. LLM이 자주 틀리는 패턴을 발견하면, 파인튜닝이 아닌 **`LLMFilter`의 프롬프트를 수정하고 개선**하는 방식으로 성능을 올립니다. (No-Code/Low-Code 방식)
*   **V2 로드맵:** 자동 파인튜닝 파이프라인 구축은 V1의 핵심 가설이 검증되고, 충분한 양의 학습 데이터가 쌓인 후의 V2 과제로 명시적으로 연기합니다.

### 원칙 3: "읽기 성능"을 고려한 데이터베이스 설계

*   **인덱싱 전략 명시:** `LLM_LOGS` 테이블의 `Database_Schema.md`에 코치의 피드백 화면 로딩 속도를 보장하기 위한 **복합 인덱스(Composite Index)** 설계를 추가합니다. (e.g., `(coach_id, created_at)`)
*   **UI/API 정책 제안:** 코치가 피드백을 주는 화면은 기본적으로 **최근 7일간의 로그만** 보여주도록 페이지네이션(Pagination)을 강제하여, 전체 테이블 스캔을 방지하고 DB 부하를 줄입니다.

## 3. 기대 효과

*   **OPEX 최소화:** LLM 호출 횟수와 토큰 사용량을 V1 단계에서 예측 가능한 수준으로 제어합니다.
*   **CAPEX 최소화:** 수백, 수천만 원에 달할 수 있는 MLOps 파이프라인 구축 비용을 V1에서 완전히 제거합니다.
*   **빠른 MVP 출시:** 복잡한 AI/ML 파이프라인 대신, 핵심적인 백엔드 로직과 프롬프트 엔지니어링에 집중하여 시장 검증을 앞당길 수 있습니다.
